
// Created by mousymous at March 9 and finished at March 10


#include <netinet/in.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <string.h>
#include <sys/types.h>
#include <sys/socket.h>

#define PORT 1000

struct Var{

  int server_socket;
  int client_socket;

};

void _conf_address(struct sockaddr_in * address){
  address -> sin_family = AF_INET;
  address -> sin_port = htons(PORT);
  address -> sin_addr.s_addr = INADDR_ANY;
}

void _create_socket(struct Var * var) {
  if ( (var -> server_socket = socket(PF_INET, SOCK_STREAM, 0)) < 0){
    fprintf(stderr, "Error at building socket...\n");
    exit(-1);
  }
  
}

void _bind_socket(struct Var * var, struct sockaddr_in * address){
  if ( bind(var -> server_socket, (struct sockaddr*)&*address, sizeof(*address)) < 0 ){
    fprintf(stderr, "Binding Error...\n");
    exit(-1);
  }
}

void _listen_socket(struct Var * var){
  if ( listen(var -> server_socket, 10) < 0){
    fprintf(stderr, "Error at listening...\n");
    exit(-1);
  }
}

void _accept_socket(struct Var * var, struct sockaddr_in * address){
  socklen_t address_len = sizeof(&address);
  if ( (var -> client_socket = accept(var -> server_socket, (struct sockaddr*)&*address, &address_len)) < 0 ) {
    fprintf(stderr, "Error Connection...\n");
    exit(-1);
  }

  fprintf(stdout, "\n\nConnection Established...\n\n");
}

void _send_commands(struct Var * var){

  char buffer[1024];

  while (1) {
    printf("command: "); fgets(buffer, sizeof(buffer), stdin);
    send(var -> client_socket, buffer, sizeof(buffer), 0);
  }
}

int main(int argv, char * argc[]) {

  struct sockaddr_in address;
  struct Var var;

  _conf_address(&address);
  _create_socket(&var);
  _bind_socket(&var, &address);
  _listen_socket(&var);
  _accept_socket(&var, &address);
  _send_commands(&var);

  close(var.server_socket);
  return 0;
}

